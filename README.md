
# Курс по микросервисной архитектуре Artsofte

# Система управления подарочными картами (GiftCards System)

## 1. Функциональные требования

1. Система позволяет выпускать партии подарочных карт с параметрами: номинал, валюта, вендор, срок действия, количество.
2. Каждая карта имеет уникальный код, который хранится только в виде хэша (SHA256); поиск осуществляется по хэшу.
3. Карта может находиться в одном из статусов:  
   `Available → Reserved → Activated`, побочные: `Blocked`, `Expired`.
4. Нельзя активировать несуществующую, просроченную, заблокированную или уже активированную карту.
5. Система должна исключать двойную активацию (идемпотентность).
6. Все изменения статусов логируются в журнал (время, пользователь, операция).
7. Должна быть поддержка поиска и фильтрации карт, партий по статусу, сроку, вендору, номиналу и части кода.
8. Все запросы проходят валидацию данных. При ошибках возвращается подробное описание.
9. Система должна предоставлять метрики и /health эндпоинт для проверки состояния БД и сервисов.
10. Архитектура должна позволять расширение для взаимодействия сервисов (через HTTP, RPC, SAGA, Redis).

---

## 2. Архитектура и сервисы

Система разделена на два микросервиса:

### **1. GiftCatalogApi (трёхслойная архитектура)**

**Назначение:** управляет всеми справочными и базовыми сущностями — вендорами, номиналами, партиями и картами.

**Функциональность:**
- Создание партий и автоматическая генерация карт.
- Просмотр, фильтрация и изменение статусов карт.
- Проверка карт по коду (для дальнейшей активации).
- Базовые CRUD-операции по справочникам.

**Слои:**
- Api
- Logic
- Dal

---

### **2. Activation (Onion-архитектура)**

**Назначение:** управляет процессом активации карты пользователем.

**Функциональность:**
- Создание и подтверждение активации.
- Проверка статуса карты через `GiftCatalogApi`.
- Логирование операций и ошибок.
- Обеспечение идемпотентности.

**Слои:**
- Api
- Services
- Domain
- Infrastructure

---

## 3. System Design схема
